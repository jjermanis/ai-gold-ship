<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>競馬</title>

<style>
body {
    margin: 0;
    background: #1b5e20;
    font-family: "Hiragino Kaku Gothic Pro", "Yu Gothic", sans-serif;
    color: white;
}

h1 {
    text-align: center;
    margin: 10px 0;
    font-size: 38px;
    letter-spacing: 4px;
}

#track {
    position: relative;
    height: 460px;
    background: linear-gradient(#2e7d32, #1b5e20);
    border-top: 10px solid #c8e6c9;
    border-bottom: 10px solid #c8e6c9;
    overflow: hidden;
}

/* Finish line */
#finish {
    position: absolute;
    left: 80px;
    top: 0;
    width: 14px;
    height: 100%;
    background: repeating-linear-gradient(
        to bottom,
        white 0px,
        white 12px,
        black 12px,
        black 24px
    );
}

/* Horse container (movement wrapper) */
.horse {
    position: absolute;
    right: 240px;
    width: 48px;
    height: 48px;
}

/* === 48x48 PIXEL HORSE (LEFT-FACING) === */

.pixel-horse {
    position: relative;
    width: 48px;
    height: 48px;
    image-rendering: pixelated;
}

/* Body */
.pixel-horse .body {
    position: absolute;
    width: 26px;
    height: 14px;
    left: 14px;
    top: 20px;
}

/* Neck (left-facing) */
.pixel-horse .neck {
    position: absolute;
    width: 8px;
    height: 10px;
    left: 8px;
    top: 14px;
}

/* Head (left-facing) */
.pixel-horse .head {
    position: absolute;
    width: 10px;
    height: 8px;
    left: 0px;
    top: 12px;
}

/* Mane / fringe */
.pixel-horse .mane {
    position: absolute;
    width: 14px;
    height: 6px;
    left: 6px;
    top: 8px;
}

/* Tail (right side) */
.pixel-horse .tail {
    position: absolute;
    width: 6px;
    height: 10px;
    left: 40px;
    top: 20px;
}

/* Legs */
.pixel-horse .leg {
    position: absolute;
    width: 4px;
    height: 10px;
    top: 34px;
    background: #222;
}
.pixel-horse .l1 { left: 16px; }
.pixel-horse .l2 { left: 22px; }
.pixel-horse .l3 { left: 28px; }
.pixel-horse .l4 { left: 34px; }

/* Name labels */
.name {
    position: absolute;
    right: 40px;
    width: 180px;
    font-size: 18px;
}

/* === COLOR THEMES (BODY + FRINGE) === */

.p1 .body,
.p1 .neck,
.p1 .head,
.p1 .tail {
    background: #e6c8a0;
}
.p1 .mane {
    background: #3e2723;
}

.p2 .body,
.p2 .neck,
.p2 .head,
.p2 .tail {
    background: #4e342e;
}
.p2 .mane {
    background: #ffffff;
}

.gold .body,
.gold .neck,
.gold .head,
.gold .tail {
    background: #dcdcdc;
}
.gold .mane {
    background: #9e9e9e;
}

.safe .body,
.safe .neck,
.safe .head,
.safe .tail {
    background: #6d4c41;
}
.safe .mane {
    background: #3e2723;
}

/* Start button */
#startBtn {
    position: fixed;
    bottom: 18px;
    left: 50%;
    transform: translateX(-50%);
    background: #ffeb3b;
    border: none;
    border-radius: 10px;
    padding: 14px 34px;
    font-size: 20px;
    font-weight: bold;
    cursor: pointer;
}
#startBtn:hover {
    background: #fdd835;
}

#info {
    text-align: center;
    margin: 6px;
    font-size: 16px;
}
</style>
</head>

<body>

<h1>競馬</h1>

<div id="info">
プレイヤー1：Q ↑ / A ↓　｜　プレイヤー2：O ↑ / L ↓
</div>

<div id="track">
    <div id="finish"></div>

    <div class="horse p1" style="top:45px">
        <div class="pixel-horse">
            <div class="mane"></div>
            <div class="head"></div>
            <div class="neck"></div>
            <div class="body"></div>
            <div class="tail"></div>
            <div class="leg l1"></div>
            <div class="leg l2"></div>
            <div class="leg l3"></div>
            <div class="leg l4"></div>
        </div>
    </div>
    <div class="name" style="top:55px">プレイヤー1</div>

    <div class="horse p2" style="top:145px">
        <div class="pixel-horse">
            <div class="mane"></div>
            <div class="head"></div>
            <div class="neck"></div>
            <div class="body"></div>
            <div class="tail"></div>
            <div class="leg l1"></div>
            <div class="leg l2"></div>
            <div class="leg l3"></div>
            <div class="leg l4"></div>
        </div>
    </div>
    <div class="name" style="top:155px">プレイヤー2</div>

    <div class="horse gold" style="top:245px">
        <div class="pixel-horse">
            <div class="mane"></div>
            <div class="head"></div>
            <div class="neck"></div>
            <div class="body"></div>
            <div class="tail"></div>
            <div class="leg l1"></div>
            <div class="leg l2"></div>
            <div class="leg l3"></div>
            <div class="leg l4"></div>
        </div>
    </div>
    <div class="name" style="top:255px">ゴールドシップ</div>

    <div class="horse safe" style="top:345px">
        <div class="pixel-horse">
            <div class="mane"></div>
            <div class="head"></div>
            <div class="neck"></div>
            <div class="body"></div>
            <div class="tail"></div>
            <div class="leg l1"></div>
            <div class="leg l2"></div>
            <div class="leg l3"></div>
            <div class="leg l4"></div>
        </div>
    </div>
    <div class="name" style="top:355px">安全走</div>
</div>

<button id="startBtn" onclick="startRace()">レース開始</button>

<script>
const horses = document.querySelectorAll(".horse");
const names = document.querySelectorAll(".name");

const speeds = [
    { target: 5, current: 0 },
    { target: 5, current: 0 },
    { target: 5, current: 0 },
    { target: 5, current: 0 }
];

let racing = false;

function speak(text) {
    const u = new SpeechSynthesisUtterance(text);
    u.lang = "ja-JP";
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
}

document.addEventListener("keydown", e => {
    if (e.key === "q") speeds[0].target = Math.min(20, speeds[0].target + 1);
    if (e.key === "a") speeds[0].target = Math.max(0, speeds[0].target - 1);
    if (e.key === "o") speeds[1].target = Math.min(20, speeds[1].target + 1);
    if (e.key === "l") speeds[1].target = Math.max(0, speeds[1].target - 1);
});

function startRace() {
    if (racing) return;
    racing = true;

    horses.forEach(h => h.style.right = "240px");

    speeds.forEach(s => {
        s.target = 5;
        s.current = 2.5;
    });

    speak("レース開始");
    requestAnimationFrame(loop);
}

function loop() {
    if (!racing) return;

    horses.forEach((horse, i) => {
        const s = speeds[i];
        s.current += (s.target - s.current) * 0.15;

        let pos = parseFloat(horse.style.right);
        pos += s.current;
        horse.style.right = pos + "px";

        if (pos > window.innerWidth - 220) {
            racing = false;
            speak(names[i].innerText + " が 勝ちました");
        }
    });

    requestAnimationFrame(loop);
}
</script>

</body>
</html>
